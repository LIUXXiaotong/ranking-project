---
title: "Pilot_the_simulation"
author: "Tong"
date: "11/7/2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, echo = FALSE)
library(tidyverse)
library(viridis)
library(ggpubr)
library(cowplot)
library(ggplot2)
library(rlang)

two_edge_events <- read.csv("two_edge_events.csv")
two_edge_events_with_d <- read.csv("two_edge_events_with_d.csv")
edge_indiff_events <- read.csv("edge_indiff_events.csv")
edge_indiff_events_with_d <- read.csv("edge_indiff_events_with_d.csv")
two_indiff_events <- read.csv("two_indiff_events.csv")
two_indiff_events_with_d <- read.csv("two_indiff_events_with_d.csv")

```

#

```{r function draw_a, echo=FALSE, message=FALSE, warning=FALSE}
draw_a <- function (x){
  df1 <- x %>%
  pivot_longer(prob_type1: prob_correct, names_to = "group",
               values_to = "value")
  a <- ggplot(df1, aes(x=sample_size, y=value, fill=group)) + 
    geom_area(alpha=0.6 , size=.5, colour="black") + 
    scale_fill_viridis(discrete = T) +
  xlab("sample size") +
  ylab(expression(paste("Average rates of giving \n each type of rankings"))) +
scale_fill_discrete(name = "Type of rankings", labels=c("Logically correct", "Type 1", "Type 2", "Type 3"))
  
  return(a)
}

```


```{r ggplot draw_a, echo=FALSE, message=FALSE, warning=FALSE}
 a1 <- draw_a(two_edge_events) +
  ggtitle(expression(paste("Ranking two pairs of edge events, \n d = 0"))) +
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none")

 a2 <- draw_a(two_edge_events_with_d) +
  ggtitle(expression(paste(" \n d = 0.3"))) +  
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none") 


 a3 <- draw_a(edge_indiff_events) +
    ggtitle(expression(paste("Ranking one pair of edge events and one pair of indifferent events, \n d = 0"))) +
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none") 
 

a4 <- draw_a(edge_indiff_events_with_d) +
  ggtitle(expression(paste(" \n d = 0.3"))) +     
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none")

a5 <- draw_a(two_indiff_events) +
  ggtitle(expression(paste("Ranking two pairs of middle events, \n d = 0"))) +
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none") 

a6 <- draw_a(two_indiff_events_with_d) +    
  ggtitle(expression(paste(" \n d = 0.3"))) +
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none") 


a_all <- plot_grid(
  a1, a2, a3, a4, a5, a6,
  ncol=2,
  nrow = 3
)



# extract a legend that is laid out horizontally
legend_a <- get_legend(
  a1 + 
    guides(color = guide_legend(nrow = 1)) +
    theme(legend.position = "right")
)

# add the legend underneath the row we made earlier. Give it 10%
# of the height of one plot (via rel_heights).
plot_grid(a_all, legend_a, rel_widths = c(3, .4))


ggsave("a_all.jpg")

```

#
```{r ggplot draw_prob_correct,echo=FALSE, message=FALSE, warning=FALSE}
prob_correct <- data.frame(sample_size = 1:20, two_edge_events = two_edge_events$prob_correct, two_edge_events_with_d = two_edge_events_with_d$prob_correct, 
           edge_indiff_events = edge_indiff_events$prob_correct, edge_indiff_events_with_d = edge_indiff_events_with_d$prob_correct,
           two_indiff_events = two_indiff_events$prob_correct,  two_indiff_events_with_d = two_indiff_events_with_d$prob_correct) %>%
  set_names(c("sample_size", "edge events only, noise term d = 0", 
              "edge events only, noise term d = 0.3", 
              "edge events + middle events, noise term d = 0", 
              "edge events + middle events, noise term d = 0.3",
              "middle events only, noise term d = 0", 
              "middle events only, noise term d = 0.3"))



prob_correct  <- prob_correct %>%
  pivot_longer(2:7, names_to = "condition", values_to = "value")


ggplot(prob_correct, aes(sample_size, value, group = condition)) +
  geom_line(aes(linetype = condition, col = condition), size = 1.25) +
  scale_color_manual(values =  c("grey57", "grey57", "black", "black", "blue", "blue")) +
  scale_linetype_manual(values = c(1, 2, 3, 4, 5, 6)) +
  theme(legend.position = c(.20, .65)) +
   theme(legend.position='bottom') + 
  ylab(expression(paste("The average rate of giving \n logically correct responses"))) + 
  xlab("Sample size N")  + 
  theme(plot.margin = margin(l = 80, t = 40, b=0, r = 100)) +
  theme(legend.key.width = unit(1.5,"cm")) + 
  scale_x_continuous(breaks = seq(0, 10, 1)) +
    guides(color = guide_legend(nrow = 3)) +
   theme(legend.title=element_text(size=8), 
    legend.text=element_text(size=8))
 
```


#
```{r function draw b,echo=FALSE, message=FALSE, warning=FALSE}

draw_b <- function (x){

  
df2 <- x %>%
  mutate(con_prob_type1 = prob_type1 / (1-prob_correct),
         con_prob_type2 = prob_type2 / (1-prob_correct),
         con_prob_type3 = prob_type3 / (1-prob_correct),
         con_all = con_prob_type1 + con_prob_type2 + con_prob_type3) %>% 
  pivot_longer(con_prob_type1: con_prob_type3, names_to = "group",
               values_to = "value") 



b <- ggplot(df2, aes(x=sample_size, y=value, fill=group)) + 
    geom_area(alpha=0.6 , size=0.5, colour="black") + 
    scale_fill_viridis(discrete = T) + 
  xlab("sample size") +
  ylab(expression(paste("Average rates of \n giving each type of rankings \n given that the rankings \n are logically incorrect"))) +
scale_fill_discrete(name = "Type of rankings", labels=c("Type 1", "Type 2", "Type 3"))


return(b)
}

```



```{r ggplot draw_b,echo=FALSE, message=FALSE, warning=FALSE}
 b1 <- draw_b(two_edge_events) +
  ggtitle(expression(paste("Ranking two pairs of edge events, \n d = 0"))) +
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none")

 b2 <- draw_b(two_edge_events_with_d) +
  ggtitle(expression(paste(" \n d = 0.3"))) +  
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none") 


 b3 <- draw_b(edge_indiff_events) +
    ggtitle(expression(paste("Ranking one pair of edge events and one pair of indifferent events, \n d = 0"))) +
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none") 
 
b4 <- draw_b(edge_indiff_events_with_d) +
  ggtitle(expression(paste(" \n d = 0.3"))) +     
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none")

b5 <- draw_b(two_indiff_events) +
  ggtitle(expression(paste("Ranking two pairs of middle events, \n d = 0"))) +
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none") 

b6 <- draw_b(two_indiff_events_with_d) +    
  ggtitle(expression(paste(" \n d = 0.3"))) +
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none") 


b_all <- plot_grid(
  b1, b2, b3, b4, b5, b6,
  ncol=2,
  nrow = 3
)



# extract a legend that is laid out horizontally
legend_b <- get_legend(
  b1 + 
    guides(color = guide_legend(nrow = 1)) +
    theme(legend.position = "right")
)

# add the legend underneath the row we made earlier. Give it 10%
# of the height of one plot (via rel_heights).
plot_grid(b_all, legend_b, rel_widths = c(3, .4))



ggsave("b_all.jpg")

```

I need to come up with a better name for the y-axis in this graph. The current y-axis label is rather lengthy and wordy. 


Making qualitative predictions across the within-subject conditions:

Qualitative prediction 1): conditional probability of giving type 1 rankings: two pairs of extreme < one pair of extreme + one pair of middle < two pairs of middle.

Qualitative prediction 2): conditional probability of giving type 2 rankings: two pairs of indifferent < one pair of extreme + one pair of middle < two pairs of extreme


Making qualitative predictions within the within-subject conditions:

Qualitative prediction 3): I am not sure, but can we also compare the conditional probabilities of giving different types of rankings within one condition? For example, the conditional probabilities of giving type 2 rankings > the conditional probabilities of giving type 1 rankings, when ranking extreme events only and when ranking one extreme and one indifferent events. Actually when ranking extreme events only, the conditional probabilities of giving type 1 errors should be smaller than 0.1 (i.e., the rate calculated by using a sample size of 1).

But potentially it may confound with response style (i.e.,some people prefer to give ties and some people do not.)



```{r}
draw_b_two <- function (x){

  
df2 <- x %>%
  mutate(con_prob_type1 = prob_type1 / (1-prob_correct-prob_type3),
         con_prob_type2 = prob_type2 / (1-prob_correct-prob_type3),
         con_all = con_prob_type1 + con_prob_type2 ) %>% 
  pivot_longer(con_prob_type1: con_prob_type2, names_to = "group",
               values_to = "value") 



b <- ggplot(df2, aes(x=sample_size, y=value, fill=group)) + 
    geom_area(alpha=0.6 , size=0.5, colour="black") + 
    scale_fill_viridis(discrete = T) + 
  xlab("sample size") +
  ylab(expression(paste("Conditional probabilities"))) +
scale_fill_discrete(name = "Type of rankings", labels=c("Type 1", "Type 2"))


return(b)
}
```



```{r ggplot draw_b,echo=FALSE, message=FALSE, warning=FALSE}
 b1 <- draw_b_two(two_edge_events) +
  ggtitle(expression(paste("Ranking two pairs of edge events, \n d = 0"))) +
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none")

 b2 <- draw_b_two(two_edge_events_with_d) +
  ggtitle(expression(paste(" \n d = 0.3"))) +  
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none") 


 b3 <- draw_b_two(edge_indiff_events) +
    ggtitle(expression(paste("Ranking one pair of edge events and one pair of indifferent events, \n d = 0"))) +
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none") 
 
b4 <- draw_b_two(edge_indiff_events_with_d) +
  ggtitle(expression(paste(" \n d = 0.3"))) +     
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none")

b5 <- draw_b_two(two_indiff_events) +
  ggtitle(expression(paste("Ranking two pairs of middle events, \n d = 0"))) +
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none") 

b6 <- draw_b_two(two_indiff_events_with_d) +    
  ggtitle(expression(paste(" \n d = 0.3"))) +
    theme_half_open(6) + 
    theme(plot.margin = margin(10, 0, 0, 80)) +  
    theme(legend.position="none") 


b_all <- plot_grid(
  b1, b2, b3, b4, b5, b6,
  ncol=2,
  nrow = 3
)



# extract a legend that is laid out horizontally
legend_b <- get_legend(
  b1 + 
    guides(color = guide_legend(nrow = 1)) +
    theme(legend.position = "right")
)

# add the legend underneath the row we made earlier. Give it 10%
# of the height of one plot (via rel_heights).

title <-  ggdraw() + draw_label(expression(paste("Conditional probabilities given that \n participants make errors in the rankings and do not give type 3 rankings")))
p1 <- plot_grid(b_all, legend_b, rel_widths = c(3, .4))  
 
plot_grid(title, p1, ncol=1, rel_heights=c(0.15, 1))


ggsave("b_all2.jpg")

```




